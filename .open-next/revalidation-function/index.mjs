globalThis.openNextDebug = false;globalThis.openNextVersion = "3.7.7";
var L=Object.defineProperty;var m=(e,r)=>()=>(e&&(r=e(e=0)),r);var d=(e,r)=>{for(var t in r)L(e,t,{get:r[t],enumerable:!0})};function u(e){try{return"__openNextInternal"in e}catch{return!1}}var v=m(()=>{});function i(...e){globalThis.openNextDebug&&console.log(...e)}function b(...e){console.warn(...e)}function p(...e){if(e.some(r=>I(r)))return i(...e);if(e.some(r=>u(r))){let r=e.find(t=>u(t));return r.logLevel<O()?void 0:r.logLevel===0?console.log(...e.map(t=>u(t)?`${t.name}: ${t.message}`:t)):r.logLevel===1?b(...e.map(t=>u(t)?`${t.name}: ${t.message}`:t)):console.error(...e)}console.error(...e)}function O(){switch((process.env.OPEN_NEXT_ERROR_LOG_LEVEL??"1").toLowerCase()){case"debug":case"0":return 0;case"error":case"2":return 2;default:return 1}}var C,I,l=m(()=>{v();C=[{clientName:"S3Client",commandName:"GetObjectCommand",errorName:"NoSuchKey"}],I=e=>C.some(r=>r.clientName===e?.clientName&&r.commandName===e?.commandName&&(r.errorName===e?.error?.name||r.errorName===e?.error?.Code))});var x={};d(x,{default:()=>P});var R,P,_=m(()=>{R={convertFrom(e){let r=e.Records.map(t=>{let{host:n,url:o}=JSON.parse(t.body);return{host:n,url:o,id:t.messageId}});return Promise.resolve({type:"revalidate",records:r})},convertTo(e){return Promise.resolve({type:"revalidate",batchItemFailures:e.records.map(r=>({itemIdentifier:r.id}))})},name:"sqs-revalidate"},P=R});var h={};d(h,{default:()=>D,formatWarmerResponse:()=>y});import{Writable as S}from"node:stream";function y(e){return new Promise(r=>{setTimeout(()=>{r({serverId,type:"warmer"})},e.delay)})}var T,D,w=m(()=>{T=async(e,r)=>async t=>{if("type"in t)return y(t);let n=await r.convertFrom(t),s=await e(n,{streamCreator:{writeHeaders:()=>new S({write:(f,c,a)=>{a()}})}});return r.convertTo(s,t)},D={wrapper:T,name:"aws-lambda",supportStreaming:!1}});import $ from"node:fs";import W from"node:https";import j from"node:path";l();async function g(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(_(),x))).default}async function N(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(w(),h))).default}async function E(e){let r=await import("./open-next.config.mjs").then(c=>c.default);globalThis.openNextConfig=r;let t=r[e.type],n=t&&"override"in t?t.override:void 0,o=await g(n?.converter),{name:s,wrapper:f}=await N(n?.wrapper);return i("Using wrapper",s),f(e.handler,o)}l();var A=G(),F=async e=>{let r=[];for(let t of e.records){let{host:n,url:o}=t;i("Revalidating stale page",{host:n,url:o});try{await new Promise((s,f)=>{let c=W.request(`https://${n}${o}`,{method:"HEAD",headers:{"x-prerender-revalidate":A.preview.previewModeId,"x-isr":"1"}},a=>{i("revalidating",{url:o,host:n,headers:a.headers,statusCode:a.statusCode}),(a.statusCode!==200||a.headers["x-nextjs-cache"]!=="REVALIDATED")&&r.push(t),s(a)});c.on("error",a=>{p("Error revalidating page",{host:n,url:o}),f(a)}),c.end()})}catch{r.push(t)}}return r.length>0&&p(`Failed to revalidate ${r.length} pages`,{failedRecords:r}),{type:"revalidate",records:r}},ee=await E({handler:F,type:"revalidate"});function G(){let e=j.join("prerender-manifest.json"),r=$.readFileSync(e,"utf-8");return JSON.parse(r)}export{ee as handler};
